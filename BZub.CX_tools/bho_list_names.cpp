/*
    BHO LIST NAMES v1.0 
    -
    INTECO-CERT
    -
    David Reguera García 
    david.reguera@inteco.es
*/

#include <stdio.h>
#include <string.h>

int BhoListNames( FILE * );

int main( int argc, char * argv[] )
{
    int    return_function;
    FILE * dump_file;
    
    return_function = 0;
    
    puts
    (
        "\n"
        " David Reguera Garcia                           \n"
        " -----------------------------------------------\n"
        " BHO List Names  [ v1.0 ]    -    INTECO-CERT   \n"
        "____________________________________________________\n\n"
    );
    
    if ( argc < 2 )
        dump_file = stdout;
    else if ( argc == 2 )
    {
        dump_file = fopen( argv[1], "a" );
        if ( dump_file == NULL )
        {
            perror( "" );
            return_function = -1;
        }
    }
    else
    {
        printf( " Uso: %s [dump_file]\n\n", argv[0] );
        return_function = -1;
    }
    
    if ( return_function == 0 )
    {
        return_function = BhoListNames( dump_file );

        if ( argc == 2 )
            if ( fclose( dump_file ) == EOF )
                perror( "" );
    }

    getchar();
    
    return return_function;
}

int BhoListNames( FILE * dump_file )
{
    char   bho_name[]     = "ipv6monl.dll";
    char   byte_to_change = 7; 
    int    i;
    
    if ( strlen( bho_name ) < byte_to_change )
    {
        fprintf( dump_file, " Error: el byte a cambiar se sale de rango.\n\n" );

        return -1;
    }
    fprintf( dump_file, " Exito: el byte a cambiar no se sale de rango.\n\n" );

    fprintf( dump_file, " BHO NAME inicial: %s\n\n", bho_name );

    fprintf
    ( 
        dump_file,
        
        " Listando los nombres posibles para el BHO:\n" 
        " ------------------------------------------\n"
    );

    for ( ; bho_name[byte_to_change] >= 0x00; bho_name[byte_to_change]-- )
    {
        fprintf( dump_file, " " );
        for ( i = 0; bho_name[i] != 0x00; i++ )
            fprintf( dump_file, "%c", bho_name[i] );
        fprintf( dump_file, "\n" );
    }

    fprintf( dump_file, "\n" );
    
    return 0;
}
